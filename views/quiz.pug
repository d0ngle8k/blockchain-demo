extends layout

block content
  .container
    h1 #{__('Blockchain Quiz')}
    p #{__('Test your knowledge of blockchain concepts!')}
    
    #quiz-container
      .quiz-question(id='question-1', data-correct='b')
        h3 Question 1
        p What is a blockchain?
        .form-group
          label.radio
            input(type='radio', name='q1', value='a')
            |  A type of cryptocurrency
          br
          label.radio
            input(type='radio', name='q1', value='b')
            |  A distributed, immutable ledger of transactions
          br
          label.radio
            input(type='radio', name='q1', value='c')
            |  A single database stored on one server
          br
          label.radio
            input(type='radio', name='q1', value='d')
            |  A type of encryption algorithm
        .feedback(style='display:none')
          .correct-answer(style='display:none')
            p.text-success
              strong Correct! 
              | A blockchain is a distributed, immutable ledger that stores transactions across multiple nodes.
          .incorrect-answer(style='display:none')
            p.text-danger
              strong Incorrect. 
              | A blockchain is a distributed, immutable ledger that stores transactions across multiple nodes. It's not just a cryptocurrency, but the technology behind it.

      .quiz-question(id='question-2', data-correct='true')
        h3 Question 2
        p True or False: Changing data in one block will break the chain of all subsequent blocks.
        .form-group
          label.radio
            input(type='radio', name='q2', value='true')
            |  True
          br
          label.radio
            input(type='radio', name='q2', value='false')
            |  False
        .feedback(style='display:none')
          .correct-answer(style='display:none')
            p.text-success
              strong Correct! 
              | Each block contains a hash of the previous block. Changing any data will change the hash and invalidate all subsequent blocks.
          .incorrect-answer(style='display:none')
            p.text-danger
              strong Incorrect. 
              | When you change data in a block, its hash changes. Since the next block references that hash, the chain breaks and all subsequent blocks become invalid.

      .quiz-question(id='question-3', data-correct='c')
        h3 Question 3
        p What is the purpose of "mining" a block?
        .form-group
          label.radio
            input(type='radio', name='q3', value='a')
            |  To delete old transactions
          br
          label.radio
            input(type='radio', name='q3', value='b')
            |  To encrypt the data
          br
          label.radio
            input(type='radio', name='q3', value='c')
            |  To find a nonce that produces a hash meeting difficulty requirements
          br
          label.radio
            input(type='radio', name='q3', value='d')
            |  To verify user identities
        .feedback(style='display:none')
          .correct-answer(style='display:none')
            p.text-success
              strong Correct! 
              | Mining involves finding a nonce (number used once) that, when combined with the block data, produces a hash with a specific number of leading zeros (meeting difficulty requirements).
          .incorrect-answer(style='display:none')
            p.text-danger
              strong Incorrect. 
              | Mining is the process of finding a nonce that produces a hash meeting difficulty requirements (e.g., starting with a certain number of zeros). This proves computational work was done.

      .quiz-question(id='question-4', data-correct='b')
        h3 Question 4
        p In a distributed blockchain, what happens when one peer's blockchain is tampered with?
        .form-group
          label.radio
            input(type='radio', name='q4', value='a')
            |  All blockchains are automatically updated to match
          br
          label.radio
            input(type='radio', name='q4', value='b')
            |  The tampered blockchain becomes invalid and is rejected by the network
          br
          label.radio
            input(type='radio', name='q4', value='c')
            |  The blockchain stops working entirely
          br
          label.radio
            input(type='radio', name='q4', value='d')
            |  Nothing happens, tampering is undetectable
        .feedback(style='display:none')
          .correct-answer(style='display:none')
            p.text-success
              strong Correct! 
              | In a distributed system, the network uses consensus to determine the valid chain. A tampered chain will have invalid hashes and be rejected by other peers.
          .incorrect-answer(style='display:none')
            p.text-danger
              strong Incorrect. 
              | When a blockchain is tampered with, its hashes become invalid. The distributed network uses consensus to identify and reject the invalid chain, maintaining the integrity of the system.

      .quiz-question(id='question-5', data-correct='a')
        h3 Question 5
        p What does a "coinbase transaction" represent?
        .form-group
          label.radio
            input(type='radio', name='q5', value='a')
            |  The reward given to a miner for successfully mining a block
          br
          label.radio
            input(type='radio', name='q5', value='b')
            |  A transaction between two users
          br
          label.radio
            input(type='radio', name='q5', value='c')
            |  A fee for using the blockchain
          br
          label.radio
            input(type='radio', name='q5', value='d')
            |  An error in the blockchain
        .feedback(style='display:none')
          .correct-answer(style='display:none')
            p.text-success
              strong Correct! 
              | A coinbase transaction is the first transaction in a block. It creates new coins as a reward for the miner who successfully mined the block. This is how new cryptocurrency enters circulation.
          .incorrect-answer(style='display:none')
            p.text-danger
              strong Incorrect. 
              | A coinbase transaction is the reward given to miners for successfully mining a block. It's how new cryptocurrency is created and enters circulation.

    .form-group
      button#submit-quiz.btn.btn-primary.btn-lg Submit Quiz
      button#reset-quiz.btn.btn-default.btn-lg(style='margin-left: 10px') Reset Quiz

    #results(style='display:none')
      h2 Results
      p#score
      .progress
        .progress-bar(role='progressbar', style='width: 0%')
      br
      p
        a.btn.btn-success(href='/quiz') Try Again
        |  
        a.btn.btn-primary(href='/') Back to Home

  script.
    $(function() {
      var totalQuestions = 5;
      var userAnswers = {};

      // Handle answer selection
      $('input[type="radio"]').change(function() {
        var questionName = $(this).attr('name');
        userAnswers[questionName] = $(this).val();
      });

      // Submit quiz
      $('#submit-quiz').click(function() {
        var score = 0;
        var answered = 0;

        // Check each question
        $('.quiz-question').each(function() {
          var questionId = $(this).attr('id');
          var questionNum = questionId.split('-')[1];
          var questionName = 'q' + questionNum;
          var correctAnswer = $(this).data('correct').toString();
          var userAnswer = userAnswers[questionName];
          var $feedback = $(this).find('.feedback');
          var $correctFeedback = $(this).find('.correct-answer');
          var $incorrectFeedback = $(this).find('.incorrect-answer');

          if (userAnswer) {
            answered++;
            $feedback.show();

            if (userAnswer === correctAnswer) {
              score++;
              $correctFeedback.show();
              $incorrectFeedback.hide();
              $(this).css('background-color', '#dff0d8');
            } else {
              $correctFeedback.hide();
              $incorrectFeedback.show();
              $(this).css('background-color', '#f2dede');
            }
          }
        });

        if (answered < totalQuestions) {
          alert('Please answer all questions before submitting!');
          return;
        }

        // Show results
        var percentage = Math.round((score / totalQuestions) * 100);
        $('#score').html('You scored <strong>' + score + ' out of ' + totalQuestions + '</strong> (' + percentage + '%)');
        $('.progress-bar').css('width', percentage + '%')
          .attr('aria-valuenow', percentage)
          .addClass(percentage >= 70 ? 'progress-bar-success' : 'progress-bar-danger');
        $('#results').show();
        $('#submit-quiz').prop('disabled', true);

        // Scroll to results
        $('html, body').animate({
          scrollTop: $('#results').offset().top
        }, 500);
      });

      // Reset quiz
      $('#reset-quiz').click(function() {
        $('input[type="radio"]').prop('checked', false);
        $('.feedback').hide();
        $('.quiz-question').css('background-color', '');
        $('#results').hide();
        $('#submit-quiz').prop('disabled', false);
        userAnswers = {};
        $('html, body').animate({ scrollTop: 0 }, 500);
      });
    });
